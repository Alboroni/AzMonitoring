{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
    "parameters": {
        "AlertName": {
            "type": "string",
            "metadata": {
                "description": "Unique name (within the Resource Group) for the log alert."
            },
            "AlertDescription": {
            "type": "string",
            "metadata": {
                "description": "Description of the log  alert."
            },
              "AlertQuery": {
            "type": "string",
            "metadata": {
                "description": "Description of the log  alert."
            },
                "LAResourceId": {
            "type": "string",
            "metadata": {
                "description": "Description of the log  alert."
            },
                     "queryType": {
            "type": "string",
            "metadata": {
                "description": "Description of the log  alert."
            },
                 "querySchedule": {
            "type": "string",
            "metadata": {
                "description": "Description of the log  alert."
            },
                             "querySchedule": {
            "type": "string",
            "metadata": {
                "description": "Schdule to run the qiery."
            },
                                         "queryWindow": {
            "type": "string",
            "metadata": {
                "description": "Window thw query should evaluate"
            },


  



    },
    "variables": {
        "alertLocation": "southcentralus",
        "alertName": "samplelogalert",
        "alertDescription": "Sample log search alert",
        "alertStatus": "true",
        "alertSource":{
            "Query":"requests",
            "SourceId": "/subscriptions/a123d7efg-123c-1234-5678-a12bc3defgh4/resourceGroups/myRG/providers/microsoft.insights/components/sampleAIapplication",
            "Type":"ResultCount"
        },
        "alertSchedule":{
            "Frequency": 15,
            "Time": 60
        },
        "alertActions":{
            "SeverityLevel": "4"
        },
        "alertTrigger":{
            "Operator":"GreaterThan",
            "Threshold":"1"
        },
        "actionGrp":{
            "ActionGroup": "/subscriptions/a123d7efg-123c-1234-5678-a12bc3defgh4/resourceGroups/myRG/providers/microsoft.insights/actiongroups/sampleAG",
            "Subject": "Customized Email Header",
            "Webhook": "{ \"alertname\":\"#alertrulename\", \"IncludeSearchResults\":true }"
        }
    },
    "resources":[ {
        "name":"[parameters('alertName')]",
        "type":"Microsoft.Insights/scheduledQueryRules",
        "apiVersion": "2018-04-16",
        "location": "westeurope",
        "properties":{
            "description": "[parameters('alertDescription')]",
            "enabled": "[variables('alertStatus')]",
            "source": {
                "query": "[parameters('AlertQuery')]",
                "dataSourceId": "[parameters('LAResourceId')]",
                "queryType": "[parameters('queryType')]"
            },
            "schedule":{
                "frequencyInMinutes": "[variables('alertSchedule').Frequency]",
                "timeWindowInMinutes": "[variables('alertSchedule').Time]"
            },
            "action":{
                "odata.type": "Microsoft.WindowsAzure.Management.Monitoring.Alerts.Models.Microsoft.AppInsights.Nexus.DataContracts.Resources.ScheduledQueryRules.AlertingAction",
                "severity":"[variables('alertActions').SeverityLevel]",
                "aznsAction":{
                    "actionGroup":"[array(variables('actionGrp').ActionGroup)]",
                    "emailSubject":"[variables('actionGrp').Subject]",
                    "customWebhookPayload":"[variables('actionGrp').Webhook]"
                },
                "trigger":{
                    "thresholdOperator":"[variables('alertTrigger').Operator]",
                    "threshold":"[variables('alertTrigger').Threshold]"
                }
            }
        }
    } ]
}